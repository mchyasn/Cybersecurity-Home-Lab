# Maldocs - Getting Started with Excel 4 Macros (XLM Macros)

## Objectives

Recently, we have seen a resurgence of Excel-based malicous office documents. Howerver, instead of using VBA-style macros, they are using older style Excel 4 macros. This changes our approach to analyzing these documents, requiring a slightly different set of tools. In this challenge, you'll get hands-on with two documents that use Excel 4.0 macros to perform anti-analysis and download the next stage of the attack.

**The exercise files are in a password-protected archive using a password of:** ***infected***

Solutions and walk-through analysis is provided [here](solution.md).

This exercise is also available on the [CyberDefenders](https://cyberdefenders.org/labs/55) platform as a CTF challenge.

Want to know when the next challenge is released? Follow me on [Twitter](https://twitter.com/jstrosch)!

## Challenge Questions

This challenge will cover two samples.

### Sample 1 - MD5: fb5ed444ddc37d748639f624397cff2a  

1. This document is encrypted, what is the password to decrypt it?

2. What command argument would you use with OLEDUMP's *plugin_biff* to select all records relevant for Excel 4.0 macros?

3. This document contains six hidden sheets, what are their names?

3. What URL is the malware using to download the next stage?

4. What malware family was this document attempting to drop?

### Sample 2 - MD5: b5d469a07709b5ca6fee934b1e5e8e38  

1. This document has a very hidden sheet, what was it named?

2. This document uses *reg.exe*, what is the purpose?

3. This document goes on to perform a number of additional anti-analysis checks, what Excel 4 macro function does it use?

4. What type of payload is downloaded? How is it executed?

5. What was the payload?

## Sample information

MITRE ATT&CK Techniques: [T1566 Phishing](https://attack.mitre.org/techniques/T1566/) -> [T1566.001 Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001/)

## Suggested Tools

All of the necessary tools are installed in the [REMnux](https://remnux.org) distribution.

* Terminal/Command prompt w/ Python installed
* Oledump
* XLMDeobfuscator
* Text editor

## Additional Educational Resources

* [Getting started with OLEDUMP - my blog](https://0xevilc0de.com/analyzing-malicious-office-documents-with-oledump/)
* [Example Excel 4 macro analysis from Hack-in-the-Box 2020 workshop](https://youtu.be/_rlEpPwSIoc?t=6421)
* [Excel 4 macro reference for Get.Workspace](https://0xevilc0de.com/excel-4-macros-get-workspace-reference/)

## Solution and Walk-Through

[Solution and Walk-Through](solution.md)

## License

This content is licensed under [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/).